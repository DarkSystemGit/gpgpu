{"version":3,"file":"blink.js","sources":["../src/WebGL/Context.js","../src/common.js","../src/WebGL/Texture.js","../src/Buffer.js","../src/DeviceBuffer.js","../src/shaders/quad.vert","../src/WebGL/Program.js","../src/shaders/template.frag","../src/Kernel.js","../src/index.js"],"sourcesContent":["/**\r\n * WebGL 2.0 related objects and helpers.\r\n */\r\nexport const gl = function () {\r\n\tconst canvas = document.createElement('canvas')\r\n\tcanvas.width = canvas.height = 1\r\n\r\n\tconst options = {\r\n\t\talpha: false,\r\n\t\tantialias: false,\r\n\t\tdepth: false,\r\n\t\tstencil: false,\r\n\t}\r\n\r\n\tlet gl = canvas.getContext('webgl2', options)\r\n\r\n\tif (!gl) {\r\n\t\tthrow new Error('WebGL 2.0 not supported by the browser.')\r\n\t}\r\n\telse if (!(gl.floatExt = gl.getExtension('EXT_color_buffer_float'))) {\r\n\t\tthrow new Error('EXT_color_buffer_float not supported.')\r\n\t}\r\n\r\n\tgl.pixelStorei(gl.PACK_ALIGNMENT, 1)\r\n\tgl.pixelStorei(gl.UNPACK_ALIGNMENT, 1)\r\n\r\n\treturn gl\r\n}()\r\n\r\n\r\nexport const device = function () {\r\n\tlet device = {\r\n\t\tglslVersion: gl.getParameter(gl.SHADING_LANGUAGE_VERSION),\r\n\t\tmaxColorAttachments: gl.getParameter(gl.MAX_DRAW_BUFFERS),\r\n\t\tmaxTextureSize: gl.getParameter(gl.MAX_TEXTURE_SIZE),\r\n\t\tmaxTextureUnits: gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),\r\n\t\trenderer: gl.getParameter(gl.RENDERER),\r\n\t\tvendor: gl.getParameter(gl.VENDOR),\r\n\t}\r\n\r\n\tconst debugRendererInfo = gl.getExtension('WEBGL_debug_renderer_info')\r\n\tif (debugRendererInfo) {\r\n\t\tdevice.unmaskedRenderer = gl.getParameter(debugRendererInfo.UNMASKED_RENDERER_WEBGL),\r\n\t\tdevice.unmaskedVendor = gl.getParameter(debugRendererInfo.UNMASKED_VENDOR_WEBGL)\r\n\t}\r\n\r\n\treturn Object.freeze(device)\r\n}()\r\n\r\n\r\nexport const quadVAO = function () {\r\n\t// Quad vertices.\r\n\tconst vertices = new Float32Array([-1, 1, -1, -1, 1, 1, 1, -1])\r\n\tlet vbo = gl.createBuffer()\r\n\tgl.bindBuffer(gl.ARRAY_BUFFER, vbo)\r\n\tgl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW)\r\n\tgl.bindBuffer(gl.ARRAY_BUFFER, null)\r\n\r\n\t// Quad VAO.\r\n\tlet vao = gl.createVertexArray()\r\n\tgl.bindVertexArray(vao)\r\n\r\n\tgl.bindBuffer(gl.ARRAY_BUFFER, vbo)\r\n\tgl.enableVertexAttribArray(0)\r\n\tgl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0)\r\n\r\n\tgl.bindVertexArray(null)\r\n\tgl.bindBuffer(gl.ARRAY_BUFFER, null)\r\n\r\n\treturn vao\r\n}()","// Buffer types.\r\nconst type = (name, bytes, integer, unsigned) => Object.freeze({ name, bytes, integer, unsigned })\r\n\r\nexport const FLOAT  = type('float',  4, false, false)\r\nexport const INT32  = type('int32',  4, true,  false)\r\nexport const INT16  = type('int16',  2, true,  false)\r\nexport const INT8   = type('int8',   1, true,  false)\r\nexport const UINT32 = type('uint32', 4, true,  true)\r\nexport const UINT16 = type('uint16', 2, true,  true)\r\nexport const UINT8  = type('uint8',  1, true,  true)\r\n\r\n\r\n// TypedArray helpers.\r\nexport const arrayConstructors = new Map([\r\n\t[FLOAT,  Float32Array],\r\n\t[INT32,  Int32Array],\r\n\t[INT16,  Int16Array],\r\n\t[INT8,   Int8Array],\r\n\t[UINT32, Uint32Array],\r\n\t[UINT16, Uint16Array],\r\n\t[UINT8,  Uint8Array],\r\n])\r\n\r\nexport const arrayTypes = {\r\n\t[Float32Array]:      FLOAT,\r\n\t[Int32Array]:        INT32,\r\n\t[Int16Array]:        INT16,\r\n\t[Int8Array]:         INT8,\r\n\t[Uint32Array]:       UINT32,\r\n\t[Uint16Array]:       UINT16,\r\n\t[Uint8Array]:        UINT8,\r\n\t[Uint8ClampedArray]: UINT8,\r\n}\r\n\r\n\r\n/// Hands out all the types associated with a Buffer's data.\r\nexport function formatInfo(dataType, vectorSize = 1) {\r\n\tconst { bytes, integer, unsigned } = dataType\r\n\r\n\tconst precision = ['lowp', 'mediump', null, 'highp'][bytes - 1]\r\n\r\n\tconst inputType = integer && unsigned ? 'usampler2D' : integer ? 'isampler2D' : 'sampler2D'\r\n\r\n\tlet outputType = null\r\n\tif (vectorSize == 1) {\r\n\t\toutputType = integer && unsigned ? 'uint' : integer ? 'int' : 'float'\r\n\t}\r\n\telse {\r\n\t\toutputType = integer && unsigned ? 'uvec' : integer ? 'ivec' : 'vec'\r\n\t\toutputType += vectorSize\r\n\t}\r\n\r\n\tlet internalFormat = ['R', 'RG', 'RGB', 'RGBA'][vectorSize - 1]\r\n\tinternalFormat += bytes * 8 + '' // 8, 16 or 32\r\n\tinternalFormat += integer && unsigned ? 'UI' : integer ? 'I' : 'F'\r\n\r\n\tlet format = ['RED', 'RG', 'RGB', 'RGBA'][vectorSize - 1]\r\n\tformat += integer ? '_INTEGER' : ''\r\n\r\n\tlet type = ''\r\n\tif (integer) {\r\n\t\tif (unsigned) {\r\n\t\t\ttype = 'UNSIGNED_'\r\n\t\t}\r\n\t\ttype += bytes == 1 ? 'BYTE' : bytes == 2 ? 'SHORT' : 'INT'\r\n\t}\r\n\telse {\r\n\t\ttype = 'FLOAT'\r\n\t}\r\n\r\n\treturn {\r\n\t\tbytes, format, internalFormat,\r\n\t\tinputType, integer, outputType,\r\n\t\tprecision, type, unsigned,\r\n\t}\r\n}\r\n\r\n\r\n/// http://stackoverflow.com/a/16267018/4757748\r\nexport function closestDimensions(area) {\r\n\tlet width = Math.floor(Math.sqrt(area))\r\n\twhile (area % width && width > 1) {\r\n\t\twidth -= 1\r\n\t}\r\n\treturn [width, area / width]\r\n}","import { gl } from './Context'\r\n\r\n/**\r\n * Internal (helper) class.\r\n */\r\nexport class Texture {\r\n\r\n\tconstructor(internalFormat, width, height, format, type, data, alignment) {\r\n\t\tconst previousTex = gl.getParameter(gl.TEXTURE_BINDING_2D)\r\n\r\n\t\tthis.internalFormat = internalFormat\r\n\t\tthis.width = width\r\n\t\tthis.height = height\r\n\t\tthis.format = format\r\n\t\tthis.type = type\r\n\t\tthis.alignment = alignment\r\n\r\n\t\tthis.id = gl.createTexture()\r\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.id)\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\r\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl[this.internalFormat], width, height, 0, gl[this.format], gl[this.type], data)\r\n\r\n\t\tgl.bindTexture(gl.TEXTURE_2D, previousTex)\r\n\t}\r\n\r\n\tdelete() {\r\n\t\tif (gl.getParameter(gl.TEXTURE_BINDING_2D) == this.id) {\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null)\r\n\t\t}\r\n\t\tgl.deleteTexture(this.id)\r\n\t\tdelete this.id\r\n\t}\r\n\r\n\tcopy() {\r\n\t\tlet copy = new Texture(this.internalFormat, this.width, this.height, this.format, this.type, null, this.alignment)\r\n\r\n\t\twithTemporaryFBO(() => {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0)\r\n\t\t\tgl.readBuffer(gl.COLOR_ATTACHMENT0)\r\n\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, copy.id)\r\n\t\t\tgl.copyTexSubImage2D(gl.TEXTURE_2D, 0, 0, 0, 0, 0, this.width, this.height, 0)\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null)\r\n\t\t})\t\t\r\n\r\n\t\treturn copy\r\n\t}\r\n\r\n\tupload(data) {\r\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.id)\r\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl[this.internalFormat], this.width, this.height, 0, gl[this.format], gl[this.type], data)\r\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.id)\r\n\t\treturn this\r\n\t}\r\n\r\n\tread(data) {\r\n\t\twithTemporaryFBO(() => {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0)\r\n\t\t\tgl.readBuffer(gl.COLOR_ATTACHMENT0)\r\n\t\t\tgl.readPixels(0, 0, this.width, this.height, gl[this.format], gl[this.type], data, 0)\r\n\t\t})\r\n\r\n\t\treturn true\r\n\t}\r\n\r\n}\r\n\r\nfunction withTemporaryFBO(fn) {\r\n\tlet previousFBO = gl.getParameter(gl.FRAMEBUFFER_BINDING)\r\n\tlet fbo = gl.createFramebuffer()\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, fbo)\r\n\tfn()\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, previousFBO)\r\n\tgl.deleteFramebuffer(fbo)\r\n}","import * as common from './common'\r\nimport { device } from './WebGL/Context'\r\nimport { Texture } from './WebGL/Texture'\r\n\r\n/**\r\n * The `Buffer` object allocates memory on the host. Once the `Buffer`\r\n * is requested on the device (GPU), the contents of `Buffer`'s data\r\n * are allocated and copied from the host to the device.\r\n * \r\n * Once te device is done computing, the contents of the `Buffer` on\r\n * the device are copied back to the host.\r\n *\r\n * All device copies are stored and mainted through `BufferCache`.\r\n *\r\n * NOTE: Data of a `Buffer` are NOT retained on the device. Once the\r\n * data has been copied back to the host, the device copy will be\r\n * destroyed immediately. To retain data on the device, please use\r\n * the `DeviceBuffer` object.\r\n */\r\n\r\nexport let readablesMap = new WeakMap()\r\nexport let writablesMap = new WeakMap()\r\n\r\nexport class Buffer {\r\n\t\r\n\tconstructor({alloc, data, type = common.FLOAT, vector = 1}) {\r\n\t\tthis.vector = Math.min(Math.max(vector, 1), 4)\r\n\t\tif (this.vector == 3) {\r\n\t\t\tconsole.warn('Vector size of 3 not supported. Choosing vector size 4.')\r\n\t\t\tthis.vector = 4\r\n\t\t}\r\n\r\n\t\tlet size = alloc || data.length\r\n\t\tthis.dimensions = common.closestDimensions(size / this.vector)\r\n\r\n\t\tconst maxDimension = device.maxTextureSize ** 2\r\n\t\tif (Math.max(...this.dimensions) > maxDimension) {\r\n\t\t\tthrow new Error('Buffer size exceeds device limit.')\r\n\t\t}\r\n\r\n\t\tif (alloc !== undefined) {\r\n\t\t\tconst typedArray = common.arrayConstructors.get(type)\r\n\t\t\tthis.data = new typedArray(size)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (data instanceof Uint8ClampedArray) {\r\n\t\t\t\tthis.data = new Uint8Array(data.buffer)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.data = data\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdelete() {\r\n\t\tdelete this.data\r\n\t\tthis._finish()\r\n\t}\r\n\r\n\tcopy() {\r\n\t\treturn new Buffer({\r\n\t\t\tdata: new this.data.constructor(this.data),\r\n\t\t\tvector: this.vector,\r\n\t\t})\r\n\t}\r\n\r\n\t/// Private methods / properties.\r\n\r\n\tget formatInfo() {\r\n\t\tconst type = common.arrayTypes[this.data.constructor]\r\n\t\treturn common.formatInfo(type, this.vector)\r\n\t}\r\n\r\n\t_getReadable(forceCreate = false) {\r\n\t\tif (!readablesMap.has(this) && forceCreate) {\r\n\t\t\tconst readable = textureForBuffer(this, this.data)\t\r\n\t\t\treadablesMap.set(this, readable)\r\n\t\t}\r\n\t\treturn readablesMap.get(this)\r\n\t}\r\n\r\n\t_getWritable(forceCreate = false) {\r\n\t\tif (!writablesMap.has(this) && forceCreate) {\r\n\t\t\tconst writable = textureForBuffer(this, this.data)\r\n\t\t\twritablesMap.set(this, writable)\r\n\t\t}\r\n\t\treturn writablesMap.get(this)\r\n\t}\r\n\r\n\t_finish() {\r\n\t\tlet readable = this._getReadable()\r\n\t\tif (readable) {\r\n\t\t\treadable.delete()\r\n\t\t\treadablesMap.delete(this)\r\n\t\t}\r\n\r\n\t\tlet writable = this._getWritable()\r\n\t\tif (writable) {\r\n\t\t\twritable.delete()\r\n\t\t\twritablesMap.delete(this)\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n\r\nfunction textureForBuffer(buffer, data = null) {\r\n\tconst { bytes, internalFormat, format, type } = buffer.formatInfo\r\n\tconst [width, height] = buffer.dimensions\r\n\treturn new Texture(internalFormat, width, height, format, type, data, bytes)\r\n}","import * as common from './common'\r\nimport { device } from './WebGL/Context'\r\nimport { Texture } from './WebGL/Texture'\r\n\r\nimport { readablesMap, writablesMap } from './Buffer'\r\n\r\n/**\r\n * The `DeviceBuffer` only allocates memory on the host. Memory is\r\n * allocated the moment the `DeviceBuffer` is constructed. Memory\r\n * on the device is developer managed. Indeed, the device memory is\r\n * retained until the developer destroys the `DeviceBuffer` using\r\n * the `destroy()` method.\r\n *\r\n * Memory from the host can be copied to the device and vice versa.\r\n */\r\n\r\nexport class DeviceBuffer {\r\n\t\r\n\tconstructor({alloc, data, type = common.FLOAT, vector = 1}) {\r\n\t\tthis.vector = Math.min(Math.max(vector, 1), 4)\r\n\t\tif (this.vector == 3) {\r\n\t\t\tconsole.warn('Vector size of 3 not supported. Choosing vector size 4.')\r\n\t\t\tthis.vector = 4\r\n\t\t}\r\n\r\n\t\tthis.size = alloc || data.length\r\n\t\tthis.dimensions = common.closestDimensions(this.size / this.vector)\r\n\r\n\t\tconst maxDimension = device.maxTextureSize ** 2\r\n\t\tif (Math.max(...this.dimensions) > maxDimension) {\r\n\t\t\tthrow new Error('Buffer size exceeds device limit.')\r\n\t\t}\r\n\t\t\r\n\t\tthis.type = data ? common.arrayTypes[data.constructor] : type\r\n\r\n\t\t// Allocate on the device, immediately.\r\n\t\tlet texture = this._getReadable(true)\r\n\r\n\t\tif (data) {\r\n\t\t\tif (data.constructor == Uint8ClampedArray) {\r\n\t\t\t\tdata = new Uint8Array(data.buffer)\r\n\t\t\t}\r\n\t\t\ttexture.upload(data)\r\n\t\t}\r\n\t}\r\n\r\n\tdelete() {\r\n\t\tif (readablesMap.has(this)) {\r\n\t\t\treadablesMap.get(this).delete()\r\n\t\t\treadablesMap.delete(this)\r\n\t\t}\r\n\t}\r\n\r\n\tcopy() {\r\n\t\tlet copyReadable = this._readable.copy()\r\n\t\tlet copyBuffer = new DeviceBuffer({\r\n\t\t\talloc: this.size,\r\n\t\t\ttype: this.type,\r\n\t\t\tvector: this.vector\r\n\t\t})\r\n\r\n\t\tcopyBuffer._readable.delete()\r\n\t\tcopyBuffer._readable = copyReadable\r\n\t\treturn copyBuffer\r\n\t}\r\n\r\n\ttoDevice(data) {\r\n\t\tthis._getReadable().upload(data)\r\n\t}\r\n\r\n\ttoHost(data) {\r\n\t\tif (!data) {\r\n\t\t\tconst typedArray = common.arrayConstructors.get(this.type)\r\n\t\t\tdata = new typedArray(this.size)\r\n\t\t}\r\n\r\n\t\tthis._getReadable().read(data)\r\n\r\n\t\treturn data\r\n\t}\r\n\r\n\t/// Private methods / properties.\r\n\r\n\tget formatInfo() {\r\n\t\treturn common.formatInfo(this.type, this.vector)\r\n\t}\r\n\r\n\t_getReadable(forceCreate = false) {\r\n\t\tif (!readablesMap.has(this) && forceCreate) {\r\n\t\t\tconst { bytes, internalFormat, format, type } = this.formatInfo\r\n\t\t\tconst [width, height] = this.dimensions\r\n\t\t\treadablesMap.set(this, new Texture(internalFormat, width, height, format, type, null, bytes))\r\n\t\t}\r\n\t\treturn readablesMap.get(this)\r\n\t}\r\n\r\n\t_getWritable(forceCreate = false) {\r\n\t\tif (!writablesMap.has(this) && forceCreate) {\r\n\t\t\twritablesMap.set(this, this._getReadable(true).copy())\r\n\t\t}\r\n\t\treturn writablesMap.get(this)\r\n\t}\r\n\r\n\t_finish() {\r\n\t\t// Swap.\r\n\t\tthis._getReadable().delete()\r\n\t\treadablesMap.set(this, this._getWritable())\r\n\t\twritablesMap.delete(this)\r\n\t}\r\n\r\n}","export default `#version 300 es\r\n\r\nprecision highp float;\r\n\r\nlayout(location = 0) in vec2 pos;\r\nout vec2 bl_UV;\r\n\r\nvoid main() {\r\n\tgl_Position = vec4(pos, 0.0, 1.0);\r\n\tbl_UV = pos * 0.5 + 0.5;\r\n}`","import { gl } from  './Context'\r\nimport vertexSource from './../shaders/quad.vert'\r\n\r\n\r\n// Keep the vertex shader in memory.\r\nconst vertexShader = compileShader(gl.VERTEX_SHADER, vertexSource)\r\n\r\n\r\n/**\r\n * Internal (helper) class.\r\n */\r\nexport class Program {\r\n\r\n\tconstructor(fragSource) {\r\n\t\tlet fragShader = compileShader(gl.FRAGMENT_SHADER, fragSource)\r\n\r\n\t\tthis.id = gl.createProgram()\r\n\t\tgl.attachShader(this.id, vertexShader)\r\n\t\tgl.attachShader(this.id, fragShader)\r\n\t\tgl.deleteShader(fragShader)\r\n\r\n\t\tgl.linkProgram(this.id)\r\n\r\n\t\tif (!gl.getProgramParameter(this.id, gl.LINK_STATUS)) {\r\n\t\t\tconsole.error('Unable to link program. Info log:')\r\n\t\t\tconsole.warn(gl.getProgramInfoLog(this.id))\r\n\t\t\treturn null\r\n\t\t}\r\n\r\n\t\t// Get attributes and uniforms.\r\n\t\tthis.attributes = {}\r\n\t\tconst attribCount = gl.getProgramParameter(this.id, gl.ACTIVE_ATTRIBUTES)\r\n\t\tfor (let a = 0; a < attribCount; a++) {\r\n\t\t\tconst attribute = gl.getActiveAttrib(this.id, a)\r\n\t\t\tattribute.id = gl.getAttribLocation(this.id, attribute.name)\r\n\t\t\tthis.attributes[attribute.name] = attribute\r\n\t\t}\r\n\r\n\t\tthis.uniforms = {}\r\n\t\tconst uniformCount = gl.getProgramParameter(this.id, gl.ACTIVE_UNIFORMS)\r\n\t\tfor (let u = 0; u < uniformCount; u++) {\r\n\t\t\tconst uniform = gl.getActiveUniform(this.id, u)\r\n\t\t\tuniform.id = gl.getUniformLocation(this.id, uniform.name)\r\n\t\t\tthis.uniforms[uniform.name] = uniform\r\n\t\t}\r\n\t}\r\n\r\n\tdelete() {\r\n\t\tgl.deleteProgram(this.id)\r\n\t\tdelete this.id\r\n\t}\r\n\r\n\tsetUniform(name, ...values) {\r\n\t\tif (!this.uniforms[name]) {\r\n\t\t\t// console.warn(`${name} not a valid uniform.`)\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst { id, size, type } = this.uniforms[name]\r\n\t\r\n\t\tlet fnName = uniformsFnTable[type]\r\n\t\tif (size > 1 && fnName[fnName.length - 1] != 'v') {\r\n\t\t\tfnName += 'v'\r\n\t\t}\r\n\r\n\t\tif (fnName.indexOf('Matrix') == -1) {\r\n\t\t\tgl[fnName](id, ...values)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tgl[fnName](id, false, ...values)\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n\r\nfunction compileShader(type, source) {\r\n\t// Check if the shader defines glsl version.\r\n\tif (!(/^#version 300 es/g).test(source)) {\r\n\t\tsource = '#version 300 es\\n\\r' + source\r\n\t}\r\n\r\n\tlet shader = gl.createShader(type)\r\n\tgl.shaderSource(shader, source)\r\n\tgl.compileShader(shader)\r\n\r\n\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n\t\t// TODO: Better error logging.\r\n\t\tconst typeName = type == gl.VERTEX_SHADER ? 'vertex' : 'fragment'\r\n\t\tconst infoLog = gl.getShaderInfoLog(shader)\r\n\t\tthrow new Error(`Unable to compile ${typeName} shader. Info log: \r\n\t\t\t${infoLog}`)\r\n\t}\r\n\r\n\treturn shader\r\n}\r\n\r\n\r\nconst uniformsFnTable = {\r\n\t[gl.FLOAT]:                   'uniform1f',\r\n\t[gl.FLOAT_VEC_2]:             'uniform2f',\r\n\t[gl.FLOAT_VEC_3]:             'uniform3f',\r\n\t[gl.FLOAT_VEC_4]:             'uniform4f',\r\n\t[gl.INT]:                     'uniform1i',\r\n\t[gl.INT_VEC2]:                'uniform2i',\r\n\t[gl.INT_VEC3]:                'uniform3i',\r\n\t[gl.INT_VEC4]:                'uniform4i',\r\n\t[gl.UNSIGNED_INT]:            'uniform1ui',\r\n\t[gl.UNSIGNED_INT_VEC2]:       'uniform2ui',\r\n\t[gl.UNSIGNED_INT_VEC3]:       'uniform3ui',\r\n\t[gl.UNSIGNED_INT_VEC4]:       'uniform4ui',\r\n\t[gl.BOOL]:                    'uniform1i',\r\n\t[gl.BOOL_VEC2]:               'uniform2i',\r\n\t[gl.BOOL_VEC3]:               'uniform3i',\r\n\t[gl.BOOL_VEC4]:               'uniform4i',\r\n\t[gl.FLOAT_MAT2]:              'uniformMatrix2fv',\r\n\t[gl.FLOAT_MAT2x3]:            'uniformMatrix2x3fv',\r\n\t[gl.FLOAT_MAT2x4]:            'uniformMatrix2x4fv',\r\n\t[gl.FLOAT_MAT3]:              'uniformMatrix3fv',\r\n\t[gl.FLOAT_MAT3x2]:            'uniformMatrix3x2fv',\r\n\t[gl.FLOAT_MAT3x4]:            'uniformMatrix3x4fv',\r\n\t[gl.FLOAT_MAT4]:              'uniformMatrix4fv',\r\n\t[gl.FLOAT_MAT4x2]:            'uniformMatrix4x2fv',\r\n\t[gl.FLOAT_MAT4x3]:            'uniformMatrix4x3fv',\r\n\t[gl.SAMPLER_2D]:              'uniform1i',\r\n\t[gl.INT_SAMPLER_2D]:          'uniform1i',\r\n\t[gl.UNSIGNED_INT_SAMPLER_2D]: 'uniform1i',\t\r\n}","export default `#version 300 es\r\n\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nuniform highp ivec2 bl_Size;\r\n\r\nin vec2 bl_UV;\r\n\r\nhighp uint bl_Id() {\r\n\thighp ivec2 uv = ivec2(bl_UV * vec2(bl_Size));\r\n\treturn uint(uv.x + uv.y * bl_Size.x);\r\n}`","import { device, gl, quadVAO } from './WebGL/Context'\r\nimport { Program } from './WebGL/Program'\r\nimport { Buffer } from './Buffer'\r\nimport fragTemplate from './shaders/template.frag'\r\n\r\n/**\r\n * Inputs and outputs have to be defined beforehand. \r\n * Although this means the pipeline is *fixed*, it does allow you\r\n * to swap Buffers before executing the `Kernel`.\r\n *\r\n * Depending on the number of allowed color attachments, a `Kernel`\r\n * may have to split the number of executions in numerous steps.\r\n */\r\n\r\nexport class Kernel {\r\n\r\n\tconstructor(io, source) {\r\n\t\tthis.inputs = io.in || io.input || io.inputs || {}\r\n\t\tthis.outputs = io.out || io.output || io.outputs\r\n\r\n\t\tif (!this.outputs || !Object.values(this.outputs).length) {\r\n\t\t\tthrow new Error(`At least 1 output is required.`)\r\n\t\t}\r\n\r\n\r\n\t\t//\r\n\t\t// Check for conflicts.\r\n\t\tfor (const output of Object.keys(this.outputs)) {\r\n\t\t\tfor (const input of Object.keys(this.inputs)) {\r\n\t\t\t\tif (input === output) {\r\n\t\t\t\t\tthrow new Error(`Conflicting input/output variable name: ${input}.`)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t//\r\n\t\t// Compare maximum input variabes allowed by the device.\r\n\t\tlet inputCount = Object.values(this.inputs).length\r\n\t\tif (inputCount > device.maxTextureUnits) {\r\n\t\t\tthrow new Error(`Maximum number of inputs exceeded. Allowed: ${device.maxTextureUnits}, given: ${inputCount}.`)\r\n\t\t}\r\n\r\n\r\n\t\t//\r\n\t\t// Split the task in multiple programs based on the maximum number of outputs.\r\n\t\tconst maxOutputs = device.maxColorAttachments\r\n\t\tconst outputNames = Object.keys(this.outputs)\r\n\t\tconst outputGroupCount = Math.ceil(outputNames.length / maxOutputs)\r\n\t\tlet outputDescriptors = []\r\n\t\t\r\n\t\tlet groupStartIndex = 0\r\n\t\tfor (let a = 0; a < outputGroupCount; a++) {\r\n\t\t\tlet descriptors = {}\r\n\t\t\tfor (const [i, name] of outputNames.entries()) {\r\n\t\t\t\tconst { outputType, precision } = this.outputs[name].formatInfo\r\n\t\t\t\tdescriptors[name] = { outputType, precision }\r\n\r\n\t\t\t\tif (i >= groupStartIndex && i < groupStartIndex + maxOutputs) {\r\n\t\t\t\t\tdescriptors[name].location = i - groupStartIndex\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toutputDescriptors.push(descriptors)\r\n\t\t\tgroupStartIndex += maxOutputs\r\n\t\t}\r\n\r\n\t\t// Create the set of programs.\r\n\t\tthis.steps = new Set(outputDescriptors.map((descriptors) => {\r\n\t\t\tconst shaderSource = prepareFragmentShader(this.inputs, descriptors, source)\r\n\t\t\tlet program = new Program(shaderSource)\r\n\r\n\t\t\tlet out = []\r\n\t\t\tfor (const [name, descriptor] of Object.entries(descriptors)) {\r\n\t\t\t\tif (descriptor.location !== undefined) {\r\n\t\t\t\t\tout.push(name)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn { out, program }\r\n\t\t}))\r\n\t}\r\n\r\n\tdelete() {\r\n\t\tthis.steps.forEach((obj) => {\r\n\t\t\tobj.program.delete()\r\n\t\t})\r\n\t\tthis.steps.clear()\r\n\r\n\t\tdelete this.inputs\r\n\t\tdelete this.outputs\r\n\t\tdelete this.steps\r\n\t}\r\n\r\n\texec(uniforms = {}) {\r\n\t\t// Check dimensions.\r\n\t\tlet size = []\r\n\t\tfor (const output of Object.values(this.outputs)) {\r\n\t\t\tconst dimensions = [...output.dimensions]\r\n\t\t\tif (!size.length) {\r\n\t\t\t\tsize = dimensions\r\n\t\t\t}\r\n\t\t\telse if (size[0] != dimensions[0] || size[1] != dimensions[1]) {\r\n\t\t\t\tthrow new Error('Outputs require consistent sizes.')\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\r\n\t\t// Prepare Framebuffer.\r\n\t\tlet fbo = gl.createFramebuffer()\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, fbo)\r\n\r\n\t\t//\r\n\t\t// Run every step.\r\n\t\tfor (const step of this.steps) {\r\n\t\t\t// Output textures.\r\n\t\t\tfor (const [index, name] of step.out.entries()) {\r\n\t\t\t\tconst texture = this.outputs[name]._getWritable(true)\r\n\t\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + index, gl.TEXTURE_2D, texture.id, 0)\r\n\t\t\t}\r\n\r\n\t\t\tconst { program } = step\r\n\t\t\tgl.useProgram(program.id)\r\n\r\n\t\t\tgl.viewport(0, 0, size[0], size[1])\r\n\r\n\t\t\t// Built-in uniforms.\r\n\t\t\tprogram.setUniform('bl_Size', ...size)\r\n\r\n\t\t\t// User uniforms.\r\n\t\t\tfor (const [uniform, value] of Object.entries(uniforms)) {\r\n\t\t\t\tprogram.setUniform(uniform, value)\r\n\t\t\t}\r\n\r\n\t\t\t// Input textures.\r\n\t\t\tfor (const [index, name] of Object.keys(this.inputs).entries()) {\r\n\t\t\t\tgl.activeTexture(gl.TEXTURE0 + index)\r\n\t\t\t\tconst texture = this.inputs[name]._getReadable(true)\r\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture.id)\r\n\t\t\t\tprogram.setUniform(name, index)\r\n\t\t\t}\r\n\r\n\t\t\tgl.bindVertexArray(quadVAO)\r\n\t\t\tgl.drawBuffers(step.out.map((_, i) => gl.COLOR_ATTACHMENT0 + i))\r\n\t\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4)\r\n\t\t\tgl.bindVertexArray(null)\r\n\r\n\t\t\t// Unpacking time. But only for `Buffer`s.\r\n\t\t\tfor (const [index, name] of step.out.entries()) {\r\n\t\t\t\tconst buffer = this.outputs[name]\r\n\t\t\t\tif (buffer instanceof Buffer) {\r\n\t\t\t\t\tconst { bytes, format, type } = buffer.formatInfo\r\n\t\t\t\t\tgl.readBuffer(gl.COLOR_ATTACHMENT0 + index)\r\n\t\t\t\t\tgl.readPixels(0, 0, size[0], size[1], gl[format], gl[type], buffer.data, 0)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null)\r\n\t\t}\r\n\r\n\t\t// Clean-up all resources.\r\n\t\tconst allBuffers = [...Object.values(this.inputs), ...Object.values(this.outputs)]\r\n\t\tfor (const buffer of allBuffers) {\r\n\t\t\tbuffer._finish()\r\n\t\t}\r\n\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null)\r\n\t\tgl.deleteFramebuffer(fbo)\r\n\t}\r\n\r\n}\r\n\r\n\r\nfunction prepareFragmentShader(inputs, outputDescriptors, source) {\r\n\tlet uniforms = Object.entries(inputs).map(([name, buffer]) => {\r\n\t\tconst { inputType, precision } = buffer.formatInfo\r\n\t\treturn `uniform ${precision} ${inputType} ${name};`\r\n\t})\r\n\r\n\tlet outs = Object.entries(outputDescriptors).map(([name, props]) => {\r\n\t\tconst layout = props.location !== undefined ? `layout(location = ${props.location}) out ` : ''\r\n\t\treturn `${layout}${props.precision} ${props.outputType} ${name};`\r\n\t})\r\n\r\n\treturn `${fragTemplate}\r\n\r\n\t\t${uniforms.join('\\n\\r')}\r\n\r\n\t\t${outs.join('\\n\\r')}\r\n\r\n\t\t${source}`\r\n}","export const VERSION = {\r\n\tmajor: 0, minor: 1, patch: 1,\r\n\ttoString() { return `${this.major}.${this.minor}.${this.patch}` }\r\n}\r\n\r\nexport { device, gl as context } from './WebGL/Context'\r\nexport { Buffer } from './Buffer'\r\nexport { DeviceBuffer } from './DeviceBuffer'\r\nexport { Kernel } from './Kernel'\r\n\r\nexport { \r\n\tFLOAT,\r\n\tINT32, INT16, INT8,\r\n\tUINT32, UINT16, UINT8\r\n} from './common'"],"names":["common.FLOAT","common.closestDimensions","common.arrayConstructors","common.arrayTypes","common.formatInfo"],"mappings":"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"}